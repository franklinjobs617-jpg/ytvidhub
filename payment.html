<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Confirming PayPal Payment - NanoBananas</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./dist/output.css" />

    <!-- Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3383070348689557"
      crossorigin="anonymous"
    ></script>

    <!-- Canvas Confetti for Success Animation -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
      body {
        font-family: "Inter", sans-serif;
      }

      /* Aurora background styles from homepage */
      .aurora-bg-container {
        position: absolute;
        inset: 0;
        z-index: -1;
        overflow: hidden;
      }

      .aurora-ball {
        position: absolute;
        width: 40vw;
        height: 40vw;
        border-radius: 50%;
        filter: blur(100px);
        opacity: 0.4;
        animation: aurora-float 20s ease-in-out infinite;
      }

      .aurora-ball-1 {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        animation-delay: 0s;
      }

      .aurora-ball-2 {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        animation-delay: 10s;
      }

      @keyframes aurora-float {
        0%,
        100% {
          transform: translateY(0px) scale(1);
        }
        50% {
          transform: translateY(-20px) scale(1.1);
        }
      }

      /* Keyframes for the background element animations (Copied from your original) */
      @keyframes rotate {
        from {
          transform: rotate(0deg) scale(1);
        }

        to {
          transform: rotate(360deg) scale(1.05);
        }
      }

      @keyframes float {
        0% {
          transform: translateY(0px);
          opacity: 0;
        }

        25% {
          opacity: 0.7;
        }

        50% {
          transform: translateY(-150px);
        }

        75% {
          opacity: 0.7;
        }

        100% {
          transform: translateY(-300px);
          opacity: 0;
        }
      }

      .animated-blob-1 {
        animation: rotate 45s alternate-reverse infinite linear;
      }

      .animated-blob-2 {
        animation: rotate 60s alternate infinite linear;
      }

      .particle {
        animation: float 20s infinite linear;
      }
    </style>
  </head>

  <body class="bg-gray-50 text-gray-800 antialiased">
    <div class="relative isolate">
      <!-- Aurora background from homepage -->
      <div class="aurora-bg-container">
        <div
          class="aurora-ball aurora-ball-1"
          style="top: -20%; left: -20%"
        ></div>
        <div
          class="aurora-ball aurora-ball-2"
          style="bottom: -20%; right: -15%"
        ></div>
      </div>

      <!-- Header (Updated to match homepage) -->
      <header
        class="bg-white/80 backdrop-blur-sm sticky top-0 z-40 border-b border-gray-200"
      >
        <nav
          class="container mx-auto px-6 lg:px-8 py-4 flex justify-between items-center"
        >
          <a href="./index.html" class="flex items-center gap-3">
            <img
              src="./image/icon.webp"
              alt="YTVidHub Logo"
              class="h-10 w-auto"
            />
          </a>
        </nav>
      </header>

      <!-- Main Content Area -->
      <main
        class="min-h-[calc(100vh-80px)] w-full flex items-center justify-center p-4 z-10"
      >
        <div
          class="w-full max-w-lg bg-white/70 backdrop-blur-xl rounded-2xl shadow-xl border border-white/60 p-8 sm:p-10 transition-all duration-500"
        >
          <!-- NEW: PayPal & Brand Header -->
          <div
            class="flex justify-between items-center pb-6 border-b border-slate-200 mb-6"
          >
            <div>
              <h2 class="font-bold text-xl text-slate-800">
                Payment Confirmation
              </h2>
              <p class="text-sm text-slate-500">via PayPal</p>
            </div>
            <img
              src="./image/transparent-hd-paypal-logo-701751694777788ilpzr3lary.png"
              alt="PayPal Logo"
              class="h-20"
            />
          </div>

          <!-- State 1: Loading / Confirmation Pending -->
          <div id="loading-state" class="text-center">
            <div
              class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-6"
            >
              <i class="fas fa-spinner fa-spin text-blue-600 text-3xl"></i>
            </div>
            <h1 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">
              Waiting for Confirmation...
            </h1>
            <p class="text-slate-500 mb-8">
              We are confirming your PayPal payment. This may take a moment.
            </p>
            <button
              id="manual-check-btn"
              class="w-full bg-white text-slate-700 font-semibold py-3 px-6 rounded-lg border border-slate-300 transition-all duration-300 hover:bg-slate-50 hover:border-slate-400 disabled:opacity-70 disabled:cursor-wait"
            >
              <i class="fas fa-redo mr-2"></i> Check Status Manually
            </button>
          </div>

          <!-- State 2: Payment Success -->
          <div id="success-state" class="hidden text-center">
            <div
              class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-6"
            >
              <i class="fas fa-check text-green-500 text-3xl"></i>
            </div>
            <h1 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">
              Payment Complete!
            </h1>
            <p class="text-slate-500 mb-8">
              Your purchase was successful. Welcome aboard!
            </p>
            <a
              href="/"
              class="w-full inline-block bg-gradient-to-r from-red-500 to-orange-500 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-transform duration-300 hover:scale-105"
            >
              Go to My Account <i class="fas fa-arrow-right ml-2"></i>
            </a>
          </div>

          <!-- State 3: Payment Failed -->
          <div id="failure-state" class="hidden text-center">
            <div
              class="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-6"
            >
              <i class="fas fa-times text-red-500 text-3xl"></i>
            </div>
            <h1 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">
              Payment Failed or Canceled
            </h1>
            <p class="text-slate-500 mb-8">
              It seems there was an issue with the transaction. Please try
              again.
            </p>
            <a
              href="/pricing.html"
              class="w-full inline-block bg-white text-slate-700 font-semibold py-3 px-6 rounded-lg border border-slate-300 transition-all duration-300 hover:bg-slate-50 hover:border-slate-400"
            >
              <i class="fab fa-paypal mr-2"></i> Try Payment Again
            </a>
          </div>
        </div>
      </main>

      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const loadingState = document.getElementById("loading-state");
          const successState = document.getElementById("success-state");
          const failureState = document.getElementById("failure-state");
          const manualCheckBtn = document.getElementById("manual-check-btn");

          let pollingInterval;
          let checkAttempts = 0;
          const MAX_ATTEMPTS = 20; // Increased attempts for PayPal

          const showState = (state) => {
            loadingState.classList.add("hidden");
            successState.classList.add("hidden");
            failureState.classList.add("hidden");

            if (state === "success") {
              successState.classList.remove("hidden");
              // 烟花效果已从此移除
            } else if (state === "failure") {
              failureState.classList.remove("hidden");
            } else {
              loadingState.classList.remove("hidden");
            }
          };

          const checkPaymentStatus = async () => {
            let params = "";
            if (window.location.search.includes("PayerID")) {
              params = window.location.search;
            }

            if (
              !window.location.search.includes("PayerID") ||
              !window.location.search.includes("PayerID")
            ) {
              return "FAILURE";
            }

            try {
              const response = await fetch(
                `https://api.ytvidhub.com/prod-api/paypal/retUrl${params}`
              );
              const data = await response.json();
              if (data.code == 0) {
                return "SUCCESS";
              } else {
                return "ERROR";
              }
            } catch (error) {
              console.error("Failed to check PayPal payment status:", error);
              return "PENDING"; // Assume pending on network/server error to allow retries
            }
          };

          const pollForStatus = async () => {
            checkAttempts++;
            if (checkAttempts >= MAX_ATTEMPTS) {
              clearInterval(pollingInterval);
              showState("failure");
              return;
            }

            const status = await checkPaymentStatus();
            if (status === "SUCCESS") {
              clearInterval(pollingInterval);
              showState("success");
              // Optional: Redirect after a few seconds
              setTimeout(() => {
                window.location.href = "/";
              }, 2000); // Redirect to homepage after 5 seconds
            } else if (status === "FAILURE") {
              clearInterval(pollingInterval);
              showState("failure");
            }
          };

          manualCheckBtn.addEventListener("click", async () => {
            manualCheckBtn.disabled = true;
            manualCheckBtn.innerHTML =
              '<i class="fas fa-spinner fa-spin mr-2"></i> Checking...';

            await pollForStatus();

            if (!loadingState.classList.contains("hidden")) {
              manualCheckBtn.disabled = false;
              manualCheckBtn.innerHTML =
                '<i class="fas fa-redo mr-2"></i> Check Status Manually';
            }
          });

          showState("loading");
          pollingInterval = setInterval(pollForStatus, 3000);
          pollForStatus();
        });
      </script>

      <!-- Footer (Added to match homepage) -->
      <footer class="bg-gray-800 text-white">
        <div class="container mx-auto px-6 lg:px-8 py-12">
          <div class="grid md:grid-cols-3 gap-8 border-b border-gray-700 pb-10">
            <div class="md:col-span-1">
              <h3 class="text-xl font-bold text-blue-400">YTVidHub</h3>
              <p class="mt-3 text-gray-400 text-sm">
                The essential toolkit for video content data extraction, built
                for speed and reliability.
              </p>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-white mb-4">Navigation</h3>
              <ul class="space-y-3 text-sm">
                <li>
                  <a
                    href="./index.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Home</a
                  >
                </li>
                <li>
                  <a
                    href="./bulk-youtube-subtitle-downloader.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Bulk Downloader</a
                  >
                </li>
                <li>
                  <a
                    href="./how-to-use.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >How to Use</a
                  >
                </li>
                <li>
                  <a
                    href="./faq.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >FAQ</a
                  >
                </li>
                <li>
                  <a
                    href="./what-is-an-srt-file.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Srt File</a
                  >
                </li>
                <li>
                  <a
                    href="./blog/subtitle-accuracy-problem.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Blog</a
                  >
                </li>
              </ul>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-white mb-4">Legal</h3>
              <ul class="space-y-3 text-sm">
                <li>
                  <a
                    href="./privacy-policy.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Privacy Policy</a
                  >
                </li>
                <li>
                  <a
                    href="./terms-of-service.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Terms of Service</a
                  >
                </li>
                <li>
                  <a
                    href="./about.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >About Us</a
                  >
                </li>
              </ul>
            </div>
          </div>
          <div class="mt-10 pt-6 text-center text-gray-500 text-sm">
            <p>
              &copy; 2025 YTVidHub Technologies. All Rights Reserved. Not
              affiliated with Google or YouTube.
            </p>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>
