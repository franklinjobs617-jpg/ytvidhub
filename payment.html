<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Confirming PayPal Payment - YTVidHub</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./dist/output.css" />

    <!-- Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Canvas Confetti for Success Animation -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .aurora-bg-container {
        position: absolute;
        inset: 0;
        z-index: -1;
        overflow: hidden;
      }
      .aurora-ball {
        position: absolute;
        width: 40vw;
        height: 40vw;
        border-radius: 50%;
        filter: blur(100px);
        opacity: 0.4;
        animation: aurora-float 20s ease-in-out infinite;
      }
      .aurora-ball-1 {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .aurora-ball-2 {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        animation-delay: 10s;
      }
      @keyframes aurora-float {
        0%,
        100% {
          transform: translateY(0px) scale(1);
        }
        50% {
          transform: translateY(-20px) scale(1.1);
        }
      }
    </style>
  </head>

  <body class="bg-gray-50 text-gray-800 antialiased">
    <div class="relative isolate">
      <!-- Aurora background -->
      <div class="aurora-bg-container">
        <div
          class="aurora-ball aurora-ball-1"
          style="top: -20%; left: -20%"
        ></div>
        <div
          class="aurora-ball aurora-ball-2"
          style="bottom: -20%; right: -15%"
        ></div>
      </div>

      <!-- Header -->
      <header
        class="bg-white/80 backdrop-blur-sm sticky top-0 z-40 border-b border-gray-200"
      >
        <nav
          class="container mx-auto px-6 lg:px-8 py-4 flex justify-between items-center"
        >
          <a href="./index.html" class="flex items-center gap-3">
            <img
              src="./image/icon.webp"
              alt="YTVidHub Logo"
              class="h-10 w-auto"
            />
          </a>
        </nav>
      </header>

      <!-- Main Content Area -->
      <main
        class="min-h-[calc(100vh-80px)] w-full flex items-center justify-center p-4 z-10"
      >
        <div
          class="w-full max-w-lg bg-white/70 backdrop-blur-xl rounded-2xl shadow-xl border border-white/60 p-8 sm:p-10 transition-all duration-500"
        >
          <!-- PayPal & Brand Header -->
          <div
            class="flex justify-between items-center pb-6 border-b border-slate-200 mb-6"
          >
            <div>
              <h2 class="font-bold text-xl text-slate-800">
                Payment Confirmation
              </h2>
              <p class="text-sm text-slate-500">via PayPal</p>
            </div>
            <img
              src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg"
              alt="PayPal Logo"
              class="h-8"
            />
          </div>

          <!-- State 1: Loading / Confirmation Pending -->
          <div id="loading-state" class="hidden text-center">
            <div
              class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-6"
            >
              <i class="fas fa-spinner fa-spin text-blue-600 text-3xl"></i>
            </div>
            <h1 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">
              Confirming Your Payment...
            </h1>
            <p class="text-slate-500">
              Please wait a moment. Do not close this window.
            </p>
          </div>

          <!-- State 2: Payment Success -->
          <div id="success-state" class="hidden text-center">
            <div
              class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-6"
            >
              <i class="fas fa-check text-green-500 text-3xl"></i>
            </div>
            <h1 class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2">
              Payment Complete!
            </h1>
            <p class="text-slate-500 mb-8">
              Your purchase was successful. Welcome aboard!
            </p>
            <a
              href="/"
              class="w-full inline-block bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-transform duration-300 hover:scale-105 hover:bg-blue-700"
            >
              Go to My Account <i class="fas fa-arrow-right ml-2"></i>
            </a>
          </div>

          <!-- State 3: Payment Failed / Canceled -->
          <div id="failure-state" class="hidden text-center">
            <div
              class="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-6"
            >
              <i class="fas fa-times text-red-500 text-3xl"></i>
            </div>
            <h1
              class="text-2xl sm:text-3xl font-bold text-slate-800 mb-2"
              id="failure-title"
            >
              Payment Failed
            </h1>
            <p class="text-slate-500 mb-8" id="failure-message">
              It seems there was an issue with the transaction.
            </p>
            <a
              href="./pricing.html"
              class="w-full inline-block bg-white text-slate-700 font-semibold py-3 px-6 rounded-lg border border-slate-300 transition-all duration-300 hover:bg-slate-50 hover:border-slate-400"
            >
              <i class="fab fa-paypal mr-2"></i> View Pricing Plans
            </a>
          </div>
        </div>
      </main>

    

      <!-- Footer -->
      <footer class="bg-gray-800 text-white">
        <div class="container mx-auto px-6 lg:px-8 py-12">
          <div class="grid md:grid-cols-3 gap-8 border-b border-gray-700 pb-10">
            <div class="md:col-span-1">
              <h3 class="text-xl font-bold text-blue-400">YTVidHub</h3>
              <p class="mt-3 text-gray-400 text-sm">
                The essential toolkit for video content data extraction, built
                for speed and reliability.
              </p>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-white mb-4">Navigation</h3>
              <ul class="space-y-3 text-sm">
                <li>
                  <a
                    href="./index.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Home</a
                  >
                </li>
                <li>
                  <a
                    href="./bulk-youtube-subtitle-downloader.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Bulk Downloader</a
                  >
                </li>
                <li>
                  <a
                    href="./how-to-use.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >How to Use</a
                  >
                </li>
                <li>
                  <a
                    href="./faq.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >FAQ</a
                  >
                </li>
                <li>
                  <a
                    href="./what-is-an-srt-file.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Srt File</a
                  >
                </li>
                <li>
                  <a
                    href="./blog/subtitle-accuracy-problem.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Blog</a
                  >
                </li>
              </ul>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-white mb-4">Legal</h3>
              <ul class="space-y-3 text-sm">
                <li>
                  <a
                    href="./privacy-policy.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Privacy Policy</a
                  >
                </li>
                <li>
                  <a
                    href="./terms-of-service.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >Terms of Service</a
                  >
                </li>
                <li>
                  <a
                    href="./about.html"
                    class="hover:text-blue-400 text-gray-400 transition"
                    >About Us</a
                  >
                </li>
              </ul>
            </div>
          </div>
          <div class="mt-10 pt-6 text-center text-gray-500 text-sm">
            <p>
              &copy; 2025 YTVidHub Technologies. All Rights Reserved. Not
              affiliated with Google or YouTube.
            </p>
          </div>
        </div>
      </footer>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
          const loadingState = document.getElementById("loading-state");
          const successState = document.getElementById("success-state");
          const failureState = document.getElementById("failure-state");
          const failureTitle = document.getElementById("failure-title");
          const failureMessage = document.getElementById("failure-message");

          const showState = (state, details = {}) => {
            loadingState.classList.add("hidden");
            successState.classList.add("hidden");
            failureState.classList.add("hidden");

            if (state === "success") {
              successState.classList.remove("hidden");
              // Trigger confetti celebration!
              confetti({
                particleCount: 150,
                spread: 90,
                origin: { y: 0.6 },
              });
            } else if (state === "failure") {
              failureTitle.textContent = details.title || "Payment Failed";
              failureMessage.textContent =
                details.message || "An unexpected error occurred.";
              failureState.classList.remove("hidden");
            } else {
              // loading
              loadingState.classList.remove("hidden");
            }
          };

          const checkPaymentStatus = async () => {
            try {
              // The full query string is automatically passed from the PayPal redirect
              const response = await fetch(
                `https://api.ytvidhub.com/prod-api/paypal/retUrl${window.location.search}`
              );

              if (!response.ok) {
                // Handle HTTP errors like 500, 404 etc.
                console.error(
                  "API request failed with status:",
                  response.status
                );
                return "PENDING"; // Assume it's a temporary server issue and retry
              }

              const data = await response.json();
              if (data.code === 0) {
                return "SUCCESS";
              } else {
                console.error(
                  "API returned an error:",
                  data.msg || "Unknown error"
                );
                return "FAILURE";
              }
            } catch (error) {
              console.error("Failed to fetch payment status:", error);
              return "PENDING"; // On network error, keep polling
            }
          };

          const startPaymentVerification = () => {
            showState("loading");
            let checkAttempts = 0;
            const MAX_ATTEMPTS = 20; // Poll for up to 1 minute (20 * 3s)

            const pollingInterval = setInterval(async () => {
              checkAttempts++;
              const status = await checkPaymentStatus();

              if (status === "SUCCESS") {
                clearInterval(pollingInterval);
                showState("success");
                setTimeout(() => {
                  window.location.href = "/";
                }, 3000);
              } else if (status === "FAILURE") {
                clearInterval(pollingInterval);
                showState("failure", {
                  title: "Verification Failed",
                  message:
                    "We couldn't confirm your payment with the provider. Please contact support if you were charged.",
                });
              } else if (checkAttempts >= MAX_ATTEMPTS) {
                clearInterval(pollingInterval);
                showState("failure", {
                  title: "Verification Timed Out",
                  message:
                    "We could not confirm your payment in time. Please check your PayPal account and contact us if needed.",
                });
              }
            }, 3000);
          };

          // --- MAIN LOGIC ---
          const urlParams = new URLSearchParams(window.location.search);
          const payerId = urlParams.get("PayerID");
          const paymentId =
            urlParams.get("paymentId") || urlParams.get("token");

          // If essential params are missing, user likely canceled on PayPal's site.
          if (!payerId || !paymentId) {
            showState("failure", {
              title: "Payment Canceled",
              message:
                "It looks like you canceled the payment process. You have not been charged.",
            });
          } else {
            // If params are present, start the verification process.
            startPaymentVerification();
          }
        });
      </script>
  </body>
</html>
