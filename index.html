<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Ultimate Free YouTube Subtitle Downloader (Bulk & Single) | YTVidHub
    </title>
    <meta
      name="description"
      content="The most efficient way to download YouTube subtitles in bulk. Supports SRT, VTT, and TXT formats for multiple videos or entire playlists instantly. 100% Free."
    />
    <link href="./dist/output.css" rel="stylesheet">


    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "YTVidHub - Ultimate YouTube Subtitle Downloader",
        "url": "https://www.yourwebsite.com/",
        "potentialAction": {
          "@type": "SearchAction",
          "target": "https://www.yourwebsite.com/?q={search_term_string}",
          "query-input": "required name=search_term_string"
        }
      }
    </script>
  </head>
  <body class="bg-gray-50 text-gray-800 font-sans antialiased">
    <header
      class="bg-white shadow-lg sticky top-0 z-40 border-b border-gray-100"
    >
      <nav
        class="container mx-auto px-6 lg:px-8 py-4 flex justify-between items-center"
      >
        <a
          href="/"
          class="text-2xl font-extrabold text-gray-900 flex items-center gap-2"
        >
          <svg
            class="w-6 h-6 text-blue-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
            ></path>
          </svg>
          YTVidHub
        </a>

        <div class="hidden md:flex space-x-8 items-center text-sm">
          <a
            href="/"
            class="text-blue-600 font-semibold transition duration-150"
            >Home</a
          ><a
            href="./bulk-youtube-subtitle-downloader.html"
            class="text-gray-700 hover:text-blue-600 font-medium transition duration-150"
            >Bulk Downloader</a
          ><a
            href="./how-to-use.html"
            class="text-gray-700 hover:text-blue-600 font-medium transition duration-150"
            >How to Use</a
          ><a
            href="./faq.html"
            class="text-gray-700 hover:text-blue-600 font-medium transition duration-150"
            >FAQ</a
          >
          <a
            href="./what-is-an-srt-file.html"
            class="text-gray-700 hover:text-blue-600 font-medium transition duration-150"
            >Srt File</a
          >
          <a
            href="./terms-of-service.html"
            class="text-gray-700 hover:text-blue-600 font-medium transition duration-150"
            >Terms</a
          >
          <a
            href="./privacy-policy.html"
            class="text-gray-700 hover:text-blue-600 font-medium transition duration-150"
            >Privacy</a
          >
        </div>

        <div class="md:hidden">
          <button
            id="mobile-menu-button"
            class="text-gray-600 hover:text-blue-600 focus:outline-none p-1"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"
              ></path>
            </svg>
          </button>
        </div>
      </nav>

      <div
        id="mobile-menu"
        class="hidden fixed inset-0 bg-white z-50 transform transition-transform duration-300 translate-x-full"
      >
        <div class="flex flex-col h-full">
          <div
            class="flex justify-between items-center px-6 py-4 border-b border-gray-200 shadow-sm"
          >
            <a
              href="/"
              class="text-2xl font-extrabold text-gray-900 flex items-center gap-2"
            >
              <svg
                class="w-6 h-6 text-blue-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                ></path>
              </svg>
              YTVidHub </a
            ><button
              id="mobile-menu-close-button"
              class="text-gray-600 hover:text-blue-600 focus:outline-none p-1"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                ></path>
              </svg>
            </button>
          </div>

          <div class="flex flex-col p-6 space-y-4 flex-grow">
            <a
              href="/"
              class="text-gray-800 hover:text-blue-600 font-semibold text-lg py-3 border-b border-gray-100"
              >Home</a
            ><a
              href="./bulk-youtube-subtitle-downloader.html"
              class="text-gray-800 hover:text-blue-600 font-semibold text-lg py-3 border-b border-gray-100"
              >Bulk Downloader</a
            ><a
              href="./how-to-use.html"
              class="text-gray-800 hover:text-blue-600 font-semibold text-lg py-3 border-b border-gray-100"
              >How to Use</a
            ><a
              href="./faq.html"
              class="text-gray-800 hover:text-blue-600 font-semibold text-lg py-3 border-b border-gray-100"
              >FAQ</a
            >

            <a
              href="./what-is-an-srt-file.html"
              class="text-gray-800 hover:text-blue-600 font-semibold text-lg py-3 border-b border-gray-100"
              >Srt File</a
            >
            <a
              href="./terms-of-service.html"
              class="text-gray-800 hover:text-blue-600 font-semibold text-lg py-3 border-b border-gray-100"
              >Terms</a
            >
            <a
              href="./privacy-policy.html"
              class="text-gray-800 hover:text-blue-600 font-semibold text-lg py-3 border-b border-gray-100"
              >Privacy</a
            >
          </div>
        </div>
      </div>
    </header>

    <main>
      <section class="pt-20 pb-16 md:pt-32 md:pb-20 bg-white">
        <div class="container mx-auto px-6 lg:px-8 text-center">
          <h1
            class="text-4xl md:text-6xl font-extrabold text-gray-900 leading-tight tracking-tighter"
          >
            <span class="text-blue-600">Extract & Manage</span> YouTube
            Subtitles At Scale
          </h1>
          <p class="mt-4 text-lg md:text-xl text-gray-600 max-w-4xl mx-auto">
            The professional, free utility for high-volume caption and
            transcript management. Supports **SRT, VTT, and TXT** for single
            videos, playlists, or large URL lists.
          </p>

          <div class="mt-12 max-w-5xl mx-auto text-left">
            <div id="inputArea">
              <div
                class="relative bg-white p-6 md:p-10 rounded-2xl shadow-xl main-card border border-gray-200"
              >
                <div class="drag-overlay">
                  <div class="text-center font-bold text-blue-600">
                    <svg
                      class="w-12 h-12 mx-auto"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"
                      ></path>
                    </svg>
                    <p class="mt-2">
                      Drop URL list file here for instant bulk processing!
                    </p>
                  </div>
                </div>

                <label
                  for="urlInput"
                  class="block text-xl font-bold text-gray-800 mb-3"
                >
                  Enter YouTube URL(s)
                </label>

                <textarea
                  id="urlInput"
                  class="w-full h-32 p-4 bg-gray-50 rounded-xl resize-y focus-blue-ring border border-gray-300 text-base transition duration-200 font-mono"
                  placeholder="Paste single or multiple video/playlist links here (one per line, up to 500 URLs)..."
                ></textarea>

                <div
                  class="mt-4 flex flex-col md:flex-row items-stretch md:items-center justify-between gap-4"
                >
                  <div
                    class="flex items-center gap-4 text-sm text-gray-500 order-2 md:order-1"
                  >
                    <div class="flex items-center">
                      <span class="mr-2">File Upload:</span>
                      <label
                        for="fileInput"
                        class="cursor-pointer font-medium text-blue-600 hover:text-blue-700 hover:underline"
                      >
                        Upload .txt/.csv
                      </label>
                      <input
                        type="file"
                        id="fileInput"
                        class="hidden"
                        accept=".txt,.csv"
                      />
                    </div>
                    <a
                      href="#faq"
                      class="text-blue-500 hover:underline font-medium text-xs hidden sm:block"
                      >Need bulk format help?</a
                    >
                  </div>

                  <div
                    class="flex items-center gap-3 order-1 md:order-2 w-full md:w-auto"
                  >
                    <button
                      id="clearBtn"
                      class="text-gray-600 font-semibold py-3 px-6 rounded-lg hover:bg-gray-100 transition w-1/3 md:w-auto"
                    >
                      Clear
                    </button>
                    <button
                      id="analyzeBtn"
                      class="btn-primary text-white font-bold py-3 px-8 rounded-xl text-lg flex items-center justify-center gap-2 w-2/3 md:w-auto"
                    >
                      <svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                        ></path></svg
                      >Analyze & Extract
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div id="analyzingArea" class="hidden mt-8"></div>
            <div id="resultsArea" class="hidden mt-8">
              <div
                id="bulkActions"
                class="hidden mb-6 bg-white p-5 rounded-xl shadow-lg border border-gray-200"
              >
                <div
                  class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4"
                >
                  <div class="flex items-center gap-4">
                    <label
                      class="flex items-center gap-2 cursor-pointer text-sm font-medium text-gray-700"
                      ><input
                        type="checkbox"
                        id="selectAllCheckbox"
                        class="custom-checkbox"
                      />
                      Select All Downloadable</label
                    >
                  </div>
                  <div class="flex flex-wrap items-center gap-3">
                    <span
                      class="text-sm font-medium text-gray-700 hidden sm:inline"
                      >Global Settings:</span
                    >
                    <select id="globalLanguage" class="custom-select w-36">
                      <option value="en">English (Default)</option>
                    </select>
                    <select id="globalFormat" class="custom-select w-24">
                      <option value="srt">SRT</option>
                      <option value="txt">TXT</option>
                      <option value="vtt">VTT</option>
                    </select>
                    <button
                      id="downloadSelectedBtn"
                      class="btn-primary text-white font-semibold py-2 px-5 rounded-lg flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed text-sm"
                    >
                      <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                        ></path></svg
                      ><span id="downloadSelectedText"
                        >Download Selected (0)</span
                      >
                    </button>
                  </div>
                </div>
              </div>
              <div id="videoList" class="space-y-4"></div>
              <div id="downloadProgress" class="mt-8 hidden"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="py-20 bg-gray-50 border-t border-b border-gray-100">
        <div class="container mx-auto px-6 lg:px-8">
          <div class="text-center mb-16">
            <span
              class="text-sm font-semibold uppercase text-blue-600 tracking-wider"
              >Core Capabilities</span
            >
            <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900 mt-2">
              Engineered for Scalability and Precision
            </h2>
            <p class="mt-3 text-lg text-gray-600 max-w-4xl mx-auto">
              Leverage a robust infrastructure designed to handle thousands of
              requests seamlessly while offering granular control over every
              download.
            </p>
          </div>
          <div class="grid md:grid-cols-3 gap-8">
            <div class="bg-white p-8 rounded-xl feature-card shadow-sm">
              <div
                class="text-blue-600 mb-4 bg-blue-50 p-3 rounded-xl inline-block"
              >
                <svg
                  class="w-7 h-7"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"
                  ></path>
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mt-2">
                Batch Processing at High Speed
              </h3>
              <p class="mt-3 text-gray-600 text-base">
                Process entire YouTube playlists or drop a text file containing
                hundreds of links. Our service handles the load and bundles
                everything into one clean ZIP file for you.
              </p>
            </div>
            <div class="bg-white p-8 rounded-xl feature-card shadow-sm">
              <div
                class="text-blue-600 mb-4 bg-blue-50 p-3 rounded-xl inline-block"
              >
                <svg
                  class="w-7 h-7"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9.75 17L9 20l-1 1h8l-1-1-0.75-3M3 17h18M5 13h14a2 2 0 012 2v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-2a2 2 0 012-2zM12 9V7"
                  ></path>
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mt-2">
                Flexible Output Formats
              </h3>
              <p class="mt-3 text-gray-600 text-base">
                Export captions as structured SRT for video editing, simple TXT
                for transcripts, or VTT for web accessibility. Choose the format
                that best fits your workflow.
              </p>
            </div>
            <div class="bg-white p-8 rounded-xl feature-card shadow-sm">
              <div
                class="text-blue-600 mb-4 bg-blue-50 p-3 rounded-xl inline-block"
              >
                <svg
                  class="w-7 h-7"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 11V3m0 0L8 7m4-4l4 4m-4 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mt-2">
                Secure, Private, and Free Forever
              </h3>
              <p class="mt-3 text-gray-600 text-base">
                Our service is free, requires no login, and operates under a
                strict no-log policy. Your data and URLs are processed
                momentarily and are never stored or tracked.
              </p>
            </div>
          </div>
        </div>
      </section>

      <section class="py-20 bg-white">
        <div class="container mx-auto px-6 lg:px-8 text-center">
          <div
            class="max-w-4xl mx-auto p-12 rounded-xl bg-blue-50 border border-blue-200"
          >
            <h2 class="text-3xl font-extrabold text-gray-900">
              Start Your Extraction Workflow Today
            </h2>
            <p class="mt-4 text-lg text-gray-600">
              No sign-up, no limits. Just paste your links and get your data
              instantly.
            </p>
            <a
              href="#inputArea"
              class="mt-8 inline-flex items-center btn-primary text-white font-bold py-3.5 px-12 rounded-xl text-lg hover:bg-blue-700 transition transform"
            >
              Access the Tool
              <svg
                class="w-5 h-5 ml-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M14 5l7 7m0 0l-7 7m7-7H3"
                ></path>
              </svg>
            </a>
          </div>
        </div>
      </section>

      <section class="py-20 bg-gray-50" id="faq">
        <div class="container mx-auto px-6 lg:px-8 max-w-4xl">
          <h2
            class="text-3xl md:text-4xl font-bold text-center text-gray-900 mb-12"
          >
            Technical Q&A
          </h2>
          <div class="space-y-4">
            <details
              class="p-6 bg-white rounded-xl shadow-sm cursor-pointer border border-gray-200 hover:border-blue-400 transition duration-200"
            >
              <summary
                class="font-semibold text-lg text-gray-800 focus:outline-none"
              >
                What URL formats are supported for bulk input?
              </summary>
              <div
                class="mt-4 pt-4 border-t border-gray-100 text-gray-600 leading-relaxed text-base"
              >
                We support standard YouTube video URLs, playlist URLs, and
                channel page URLs. For bulk processing via file upload, ensure
                each URL is on a new line in a simple `.txt` or `.csv` file. The
                system automatically filters out invalid or duplicate links.
              </div>
            </details>
            <details
              class="p-6 bg-white rounded-xl shadow-sm cursor-pointer border border-gray-200 hover:border-blue-400 transition duration-200"
            >
              <summary
                class="font-semibold text-lg text-gray-800 focus:outline-none"
              >
                How does the global language setting affect my download?
              </summary>
              <div
                class="mt-4 pt-4 border-t border-gray-100 text-gray-600 leading-relaxed text-base"
              >
                The global setting allows you to specify a single subtitle
                language (e.g., 'es' for Spanish) for all videos selected in
                your batch download. If a video does not have the requested
                language, the system will skip that specific file but continue
                processing the rest of the batch.
              </div>
            </details>
            <details
              class="p-6 bg-white rounded-xl shadow-sm cursor-pointer border border-gray-200 hover:border-blue-400 transition duration-200"
            >
              <summary
                class="font-semibold text-lg text-gray-800 focus:outline-none"
              >
                Why do some videos show "No Subtitles" even though they have
                captions?
              </summary>
              <div
                class="mt-4 pt-4 border-t border-gray-100 text-gray-600 leading-relaxed text-base"
              >
                Our tool prioritizes downloading *manually uploaded or
                generated* captions. Videos that only have YouTube's
                **auto-generated** captions (which often require complex
                server-side conversion) may be filtered out to ensure the
                highest quality and accuracy of the downloaded text.
              </div>
            </details>
            <details
              class="p-6 bg-white rounded-xl shadow-sm cursor-pointer border border-gray-200 hover:border-blue-400 transition duration-200"
            >
              <summary
                class="font-semibold text-lg text-gray-800 focus:outline-none"
              >
                Is my usage data or history stored by YTVidHub?
              </summary>
              <div
                class="mt-4 pt-4 border-t border-gray-100 text-gray-600 leading-relaxed text-base"
              >
                **No.** We operate with a core commitment to user privacy. The
                system processes your request in memory to generate the output
                file, but all URL inputs, file contents, and personal
                identification data are immediately discarded upon job
                completion. We do not maintain any logs of your activity.
              </div>
            </details>
          </div>
        </div>
      </section>
    </main>

    <footer class="bg-gray-800 text-white">
      <div class="container mx-auto px-6 lg:px-8 py-12">
        <div class="grid md:grid-cols-4 gap-12 border-b border-gray-700 pb-10">
          <div>
            <h3 class="text-xl font-bold text-blue-400">YTVidHub</h3>
            <p class="mt-3 text-gray-400 text-sm">
              The essential toolkit for video content data extraction, built for
              speed and reliability.
            </p>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">Product</h3>
            <ul class="space-y-3 text-sm">
              <li>
                <a href="/" class="hover:text-blue-400 text-gray-400 transition"
                  >Bulk Subtitle Tool</a
                >
              </li>
              <li>
                <a
                  href="/documentation.html"
                  class="hover:text-blue-400 text-gray-400 transition"
                  >API Documentation</a
                >
              </li>
              <li>
                <a
                  href="/status.html"
                  class="hover:text-blue-400 text-gray-400 transition"
                  >System Status</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">Company</h3>
            <ul class="space-y-3 text-sm">
              <li>
                <a
                  href="/about.html"
                  class="hover:text-blue-400 text-gray-400 transition"
                  >About Us</a
                >
              </li>
              <li>
                <a
                  href="/careers.html"
                  class="hover:text-blue-400 text-gray-400 transition"
                  >Careers</a
                >
              </li>
              <li>
                <a
                  href="/contact.html"
                  class="hover:text-blue-400 text-gray-400 transition"
                  >Contact</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">Legal</h3>
            <ul class="space-y-3 text-sm">
              <li>
                <a
                  href="/privacy.html"
                  class="hover:text-blue-400 text-gray-400 transition"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a
                  href="/terms.html"
                  class="hover:text-blue-400 text-gray-400 transition"
                  >Terms of Service</a
                >
              </li>
              <li>
                <a
                  href="/cookies.html"
                  class="hover:text-blue-400 text-gray-400 transition"
                  >Cookie Settings</a
                >
              </li>
            </ul>
          </div>
        </div>
        <div class="mt-10 pt-6 text-center text-gray-500 text-sm">
          <p>
            &copy; 2025 YTVidHub Technologies. All Rights Reserved. Not
            affiliated with Google or YouTube.
          </p>
        </div>
      </div>
    </footer>

    <script>
      let videoData = [];
      const selectedVideos = new Set();
      let currentTaskId = null;
      let pollingInterval = null;
      let perceivedProgressInterval = null;
      let currentPerceivedProgress = 0;
      const youtubeRegex =
        /^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;

      // --- DOM Elements ---
      let inputArea, analyzingArea, resultsArea;

      const MOBILE_MENU_TRANSITION_DURATION = 400; // Match CSS duration + buffer for smooth hiding

      document.addEventListener("DOMContentLoaded", () => {
        // Main areas
        inputArea = document.getElementById("inputArea");
        analyzingArea = document.getElementById("analyzingArea");
        resultsArea = document.getElementById("resultsArea");

        // === FIX APPLIED HERE: Mobile Menu Logic ===
        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenuCloseButton = document.getElementById(
          "mobile-menu-close-button"
        );
        const mobileMenu = document.getElementById("mobile-menu");

        if (mobileMenuButton) {
          mobileMenuButton.addEventListener("click", () => {
            if (mobileMenu) {
              // 1. Remove 'hidden' instantly (makes it visible but still off-screen via translate-x-full)
              mobileMenu.classList.remove("hidden");
              // 2. Schedule removal of translate-x-full to trigger slide-in animation
              setTimeout(() => {
                mobileMenu.classList.remove("translate-x-full");
              }, 10);
              document.body.style.overflow = "hidden";
            }
          });
        }
        if (mobileMenuCloseButton) {
          mobileMenuCloseButton.addEventListener("click", () => {
            if (mobileMenu) {
              // 1. Add 'translate-x-full' to start slide-out animation
              mobileMenu.classList.add("translate-x-full");
              document.body.style.overflow = "";
              // 2. Add 'hidden' after the animation completes
              setTimeout(() => {
                mobileMenu.classList.add("hidden");
              }, MOBILE_MENU_TRANSITION_DURATION);
            }
          });
        }
        // === END FIX ===

        // Event Listeners
        document
          .getElementById("analyzeBtn")
          .addEventListener("click", handleAnalyzeClick);
        document
          .getElementById("clearBtn")
          .addEventListener("click", handleClear);
        document
          .getElementById("fileInput")
          .addEventListener("change", handleFileUpload);

        const dragContainer = document.querySelector("#inputArea");
        ["dragenter", "dragover", "dragleave", "drop"].forEach((e) =>
          dragContainer.addEventListener(e, preventDefaults, false)
        );
        ["dragenter", "dragover"].forEach((e) =>
          dragContainer.addEventListener(
            e,
            () => dragContainer.classList.add("dragging"),
            false
          )
        );
        ["dragleave", "drop"].forEach((e) =>
          dragContainer.addEventListener(
            e,
            () => dragContainer.classList.remove("dragging"),
            false
          )
        );
        dragContainer.addEventListener("drop", handleFileDrop, false);

        document
          .getElementById("selectAllCheckbox")
          .addEventListener("change", handleSelectAll);
        document
          .getElementById("downloadSelectedBtn")
          .addEventListener("click", handleBulkDownload);
      });

      // --- INPUT HANDLERS ---
      function resetToInputArea() {
        document.getElementById("urlInput").value = "";
        resultsArea.classList.add("hidden");
        analyzingArea.classList.add("hidden");
        inputArea.classList.remove("hidden");

        videoData = [];
        selectedVideos.clear();
        currentTaskId = null;
        if (pollingInterval) {
          clearInterval(pollingInterval);
          pollingInterval = null;
        }
        if (perceivedProgressInterval) {
          clearInterval(perceivedProgressInterval);
          perceivedProgressInterval = null;
        }

        const progressContainer = document.getElementById("downloadProgress");
        if (progressContainer) {
          progressContainer.innerHTML = "";
          progressContainer.classList.add("hidden");
        }

        const globalLanguageSelect = document.getElementById("globalLanguage");
        if (globalLanguageSelect) {
          // Resetting to default option
          globalLanguageSelect.innerHTML =
            '<option value="en">English (Default)</option>';
        }
      }

      function handleClear() {
        resetToInputArea();
      }

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }
      async function handleFileUpload(e) {
        const file = e.target.files[0];
        if (file) await processFile(file);
      }
      async function handleFileDrop(e) {
        const file = e.dataTransfer.files[0];
        if (file) await processFile(file);
      }
      async function processFile(file) {
        if (
          !["text/plain", "text/csv", "application/vnd.ms-excel"].includes(
            file.type
          )
        ) {
          return showNotification(
            "Invalid file type. Please use .txt or .csv",
            "error"
          );
        }
        document.getElementById("urlInput").value = await file.text();
        handleAnalyzeClick();
      }

      // --- CORE WORKFLOW ---
      async function handleAnalyzeClick() {
        const urlInput = document.getElementById("urlInput").value;

        const urlRegex = /https?:\/\/[^\s/$.?#].[^\s]*/g;
        const urls = urlInput.match(urlRegex) || [];

        if (urls.length === 0) {
          return showNotification(
            "No valid YouTube URLs found. Please check your input.",
            "error"
          );
        }

        inputArea.classList.add("hidden");
        resultsArea.classList.add("hidden");
        analyzingArea.classList.remove("hidden");
        startAnalysisProgress();

        try {
          const details = await fetchVideoDetails(urls);
          if (perceivedProgressInterval)
            clearInterval(perceivedProgressInterval);
          videoData = details.map((d) => ({
            ...d,
            selectedLanguage: "en",
            selectedFormat: "srt",
          }));
          displayResults(videoData);
          analyzingArea.classList.add("hidden");
          resultsArea.classList.remove("hidden");
        } catch (error) {
          showNotification(`Analysis Error: ${error.message}`, "error");
          resetToInputArea();
        }
      }

      async function fetchVideoDetails(urls) {
        // Mocking API call URL for the previous version's functionality.
        // The actual implementation should fetch data from a working backend.
        const response = await fetch(
          "https://ytdlp.vistaflyer.com/api/batch_check",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ urls: urls }),
          }
        );
        if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
        const data = await response.json();
        if (data.status !== "completed")
          throw new Error("Server could not process URLs.");
        return data.results.map((item) => ({
          id: (item.url.match(youtubeRegex) || [])[1],
          url: item.url,
          title: item.video_info.title || "Untitled",
          uploader: item.video_info.uploader || "Unknown",
          thumbnail: `https://i.ytimg.com/vi/${
            (item.url.match(youtubeRegex) || [])[1]
          }/hqdefault.jpg`,
          hasSubtitles: item.can_download,
          availableLanguages: item.available_manual_captions || [],
        }));
      }

      function startAnalysisProgress() {
        let percent = 0;
        const progressBar = document.getElementById("analysisProgressBar");
        const percentageText = document.getElementById(
          "analysisPercentageText"
        );
        const progressText = document.getElementById("analysisProgressText");

        perceivedProgressInterval = setInterval(() => {
          percent += (95 - percent) * 0.1;
          if (progressBar) progressBar.style.width = `${percent}%`;
          if (percentageText)
            percentageText.textContent = `${Math.floor(percent)}%`;
          if (progressText)
            progressText.textContent =
              "Analyzing URLs and fetching video data...";
          if (percent >= 94) clearInterval(perceivedProgressInterval);
        }, 400);
      }

      // Analysis UI Helper (omitted from HTML for brevity but required here for JS logic)
      if (!document.getElementById("analyzingArea").innerHTML.trim()) {
        document.getElementById("analyzingArea").innerHTML = `
            <div class="bg-white p-8 md:p-12 rounded-2xl shadow-2xl border border-gray-100 text-center">
                <svg class="w-24 h-24 text-blue-500 mx-auto opacity-75 loading-spinner" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 4H38V12H10V4Z" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 36H38V44H10V36Z" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15 12L18 22" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M33 12L30 22" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M18 22L16 36" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M30 22L32 36" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20 22H28" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <h3 class="mt-4 text-xl font-bold text-gray-800">Extracting video information, please wait...</h3>
                <div class="mt-6 max-w-md mx-auto">
                    <div class="flex justify-between mb-1 text-sm font-medium">
                        <span class="text-gray-600">Analysis Progress</span><span id="analysisPercentageText">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div
                            id="analysisProgressBar"
                            class="bg-blue-600 h-2.5 rounded-full transition-width duration-300"
                            style="width: 0%"
                        ></div>
                    </div>
                    <p
                        id="analysisProgressText"
                        class="text-center text-sm text-gray-500 mt-2"
                    >
                        Initializing connection...
                    </p>
                </div>
            </div>
        `;
      }

      // --- UI RENDERING & MANAGEMENT ---
      function displayResults(data) {
        const videoList = document.getElementById("videoList");
        const bulkActions = document.getElementById("bulkActions");
        videoList.innerHTML = "";
        selectedVideos.clear();
        if (!data || data.length === 0) return;

        data.forEach((video) => {
          if (video.hasSubtitles) selectedVideos.add(video.id);
          videoList.appendChild(createVideoCard(video));
        });

        bulkActions.classList.toggle("hidden", data.length < 1);
        updateSelectionUI();

        updateGlobalLanguageOptions(data);
      }

      function updateGlobalLanguageOptions(data) {
        const globalLanguageSelect = document.getElementById("globalLanguage");
        globalLanguageSelect.innerHTML =
          '<option value="en">English (Default)</option>';

        const allLangs = new Map();
        data.forEach((video) => {
          if (video.hasSubtitles && video.availableLanguages) {
            video.availableLanguages.forEach((lang) => {
              // Filter out default English if it's already the default option, and filter out 'auto'
              if (lang.lang_code !== "en" && lang.lang_code !== "auto") {
                allLangs.set(lang.lang_code, lang.lang_name);
              }
            });
          }
        });

        const sortedLangs = Array.from(allLangs.entries()).sort((a, b) =>
          a[1].localeCompare(b[1])
        );

        sortedLangs.forEach(([code, name]) => {
          const option = document.createElement("option");
          option.value = code;
          option.textContent = `${name} (${code})`;
          globalLanguageSelect.appendChild(option);
        });
      }

      function createVideoCard(video) {
        const card = document.createElement("div");
        card.className = `bg-white p-4 rounded-xl shadow-md border-2 transition-all duration-200 ${
          selectedVideos.has(video.id)
            ? "border-blue-500"
            : "border-gray-200 hover:border-blue-300" // Updated card hover style
        }`;
        card.id = `card-${video.id}`;

        const langOptions = video.availableLanguages
          .filter(
            (lang) => lang.lang_code !== "en" && lang.lang_code !== "auto"
          )
          .map(
            (lang) =>
              `<option value="${lang.lang_code}">${lang.lang_name}</option>`
          )
          .join("");

        card.innerHTML = `
            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
                <div class="flex items-center gap-4 flex-shrink-0">
                    ${
                      video.hasSubtitles
                        ? `<input type="checkbox" class="custom-checkbox" onchange="toggleVideoSelection('${
                            video.id
                          }')" ${
                            selectedVideos.has(video.id) ? "checked" : ""
                          }>`
                        : '<div class="w-5 h-5"></div>'
                    }
                    <img src="${
                      video.thumbnail
                    }" class="w-28 h-16 object-cover rounded-lg border border-gray-200">
                </div>
                <div class="flex-grow min-w-0">
                    <p class="font-semibold text-gray-800 truncate text-base" title="${video.title.replace(
                      /"/g,
                      "&quot;"
                    )}">${video.title}</p>
                    <p class="text-sm text-gray-500">by ${video.uploader}</p>
                    ${
                      video.hasSubtitles
                        ? '<span class="text-xs font-medium text-green-600 bg-green-100 px-2 py-0.5 rounded-full">Subtitles Available</span>' // Enhanced status badge
                        : '<span class="text-xs font-medium text-red-600 bg-red-100 px-2 py-0.5 rounded-full">No Subtitles Found</span>' // Enhanced status badge
                    }
                </div>
                ${
                  video.hasSubtitles
                    ? `
                <div class="flex flex-col sm:flex-row items-center gap-2 flex-shrink-0 ml-auto pt-2 sm:pt-0">
                    <select onchange="updateVideoSetting('${video.id}', 'selectedLanguage', this.value)" class="per-video-lang custom-select w-full sm:w-32 text-sm">
                        <option value="en">English</option>
                        ${langOptions}
                    </select>
                    <select onchange="updateVideoSetting('${video.id}', 'selectedFormat', this.value)" class="per-video-format custom-select w-full sm:w-20 text-sm">
                        <option value="srt">SRT</option><option value="txt">TXT</option><option value="vtt">VTT</option>
                    </select>
                    <button onclick="handleSingleDownload('${video.id}')" title="Download this subtitle" class="bg-gray-100 hover:bg-blue-500 hover:text-white text-gray-700 p-2 rounded-lg transition flex-shrink-0 w-full sm:w-auto"><svg class="w-5 h-5 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></button>
                </div>`
                    : ""
                }
            </div>
        `;
        return card;
      }

      function updateVideoSetting(videoId, key, value) {
        const video = videoData.find((v) => v.id === videoId);
        if (video) {
          video[key] = value;
        }
      }

      function toggleVideoSelection(videoId) {
        if (selectedVideos.has(videoId)) {
          selectedVideos.delete(videoId);
        } else {
          selectedVideos.add(videoId);
        }
        updateSelectionUI();
      }

      function handleSelectAll() {
        const isChecked = document.getElementById("selectAllCheckbox").checked;
        videoData.forEach((video) => {
          if (video.hasSubtitles) {
            if (isChecked) {
              selectedVideos.add(video.id);
            } else {
              selectedVideos.delete(video.id);
            }
          }
        });
        updateSelectionUI();
      }

      function updateSelectionUI() {
        const count = selectedVideos.size;
        const totalSelectable = videoData.filter((v) => v.hasSubtitles).length;

        document.getElementById(
          "downloadSelectedText"
        ).textContent = `Download Selected (${count})`;
        document.getElementById("downloadSelectedBtn").disabled = count === 0;

        const selectAllCheckbox = document.getElementById("selectAllCheckbox");
        selectAllCheckbox.checked = count > 0 && count === totalSelectable;
        selectAllCheckbox.indeterminate = count > 0 && count < totalSelectable;

        videoData.forEach((video) => {
          const card = document.getElementById(`card-${video.id}`);
          if (card) {
            card.classList.toggle(
              "border-blue-500",
              selectedVideos.has(video.id)
            );
            card.classList.toggle(
              "border-gray-200",
              !selectedVideos.has(video.id)
            );
            const checkbox = card.querySelector('input[type="checkbox"]');
            if (checkbox) checkbox.checked = selectedVideos.has(video.id);
          }
        });
      }

      // --- DOWNLOAD & API LOGIC ---
      async function handleSingleDownload(videoId) {
        const video = videoData.find((v) => v.id === videoId);
        if (!video) return;

        const button = event.target.closest("button");
        const originalContent = button.innerHTML;
        button.disabled = true;
        button.innerHTML =
          '<div class="loading-spinner rounded-full h-5 w-5 border-b-2 border-gray-700"></div>';

        try {
          const card = document.getElementById(`card-${videoId}`);
          const selectedLang = card.querySelector(".per-video-lang").value;
          const selectedFormat = card.querySelector(".per-video-format").value;

          await downloadFile(
            video.url,
            selectedLang,
            selectedFormat,
            video.title
          );
          showNotification(
            "Single subtitle downloaded successfully!",
            "success"
          );
        } catch (error) {
          showNotification(error.message, "error");
        } finally {
          button.disabled = false;
          button.innerHTML = originalContent;
        }
      }

      async function handleBulkDownload() {
        const videosToDownload = videoData
          .filter((v) => selectedVideos.has(v.id))
          .map((v) => ({ url: v.url, title: v.title }));
        if (videosToDownload.length === 0) return;

        const format = document.getElementById("globalFormat").value;
        const lang = document.getElementById("globalLanguage").value;

        selectedVideos.forEach((id) => {
          updateVideoSetting(id, "selectedLanguage", lang);
          updateVideoSetting(id, "selectedFormat", format);
        });

        try {
          showNotification(
            `Starting bulk download for ${videosToDownload.length} files...`,
            "info"
          );
          const task = await createBulkTask(videosToDownload, lang, format);
          currentTaskId = task.task_id;
          showProgressArea(videosToDownload.length);
          startPolling();
        } catch (error) {
          showNotification(error.message, "error");
        }
      }

      async function downloadFile(url, lang, format, title) {
        // Mocking API call URL for the previous version's functionality.
        const response = await fetch(
          "https://ytdlp.vistaflyer.com/api/download",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              url: url,
              lang: lang,
              format: format,
              title: title,
            }),
          }
        );
        if (!response.ok) throw new Error("Download failed from server.");
        const blob = await response.blob();
        const objectUrl = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = objectUrl;
        a.download = `${title
          .replace(/[^a-z0-9]/gi, "_")
          .slice(0, 60)}.${format}`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(objectUrl);
      }
      async function createBulkTask(videos, lang, format) {
        // Mocking API call URL for the previous version's functionality.
        const response = await fetch(
          "https://ytdlp.vistaflyer.com/api/batch_submit",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              videos: videos,
              lang: lang,
              format: format,
            }),
          }
        );
        if (!response.ok) throw new Error("Failed to create bulk task.");
        const data = await response.json();
        if (data.status !== "pending")
          throw new Error(data.message || "Task submission failed.");
        return data;
      }

      // --- POLLING & PROGRESS ---
      function startPolling() {
        if (pollingInterval) clearInterval(pollingInterval);
        startPerceivedProgress();
        pollingInterval = setInterval(async () => {
          if (!currentTaskId) return clearInterval(pollingInterval);
          try {
            const status = await checkTaskStatus(currentTaskId);
            if (status && status.progress_str) {
              updateProgressWithRealData(status);
            }
            if (status.status === "completed") {
              clearInterval(pollingInterval);
              handleDownloadComplete();
            } else if (status.status === "failed") {
              clearInterval(pollingInterval);
              if (perceivedProgressInterval)
                clearInterval(perceivedProgressInterval);
              showNotification("Bulk download task failed.", "error");
              handleDownloadFail();
            }
          } catch (error) {
            clearInterval(pollingInterval);
            if (perceivedProgressInterval)
              clearInterval(perceivedProgressInterval);
            showNotification("Error checking status.", "error");
            handleDownloadFail();
          }
        }, 3000);
      }

      async function checkTaskStatus(taskId) {
        // Mocking API call URL for the previous version's functionality.
        const response = await fetch(
          `https://ytdlp.vistaflyer.com/api/task_status?task_id=${taskId}`
        );
        if (!response.ok) throw new Error("Status check failed.");
        const data = await response.json();
        const [completed, total] = (data.progress || "0/0")
          .split("/")
          .map(Number);
        return {
          id: taskId,
          status: data.status,
          progress: total > 0 ? (completed / total) * 100 : 0,
          completed: completed,
          total: total,
          progress_str: data.progress,
        };
      }

      function showProgressArea(totalFiles) {
        const progressContainer = document.getElementById("downloadProgress");
        progressContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg border"><h3 class="text-lg font-semibold text-center mb-4 text-blue-600">Processing Bulk Download Task...</h3><div id="progressContent"><div class="flex justify-between mb-1 text-sm font-medium"><span>Progress</span><span id="percentageText">0%</span></div><div class="w-full bg-gray-200 rounded-full h-2.5"><div id="progressBar" class="bg-blue-600 h-2.5 rounded-full transition-width duration-300" style="width: 0%"></div></div><p id="progressText" class="text-center text-sm text-gray-500 mt-2">Connecting to server (Expected files: ${totalFiles})...</p></div></div>`;
        progressContainer.classList.remove("hidden");
      }

      function startPerceivedProgress() {
        if (perceivedProgressInterval) clearInterval(perceivedProgressInterval);
        currentPerceivedProgress = 0;
        const progressBar = document.getElementById("progressBar");
        const progressText = document.getElementById("progressText");
        const percentageText = document.getElementById("percentageText");
        perceivedProgressInterval = setInterval(() => {
          currentPerceivedProgress += (90 - currentPerceivedProgress) * 0.05;
          if (progressBar)
            progressBar.style.width = `${currentPerceivedProgress}%`;
          if (percentageText)
            percentageText.textContent = `${Math.floor(
              currentPerceivedProgress
            )}%`;
          if (progressText)
            progressText.textContent =
              "Processing files... (This may take a few minutes)";
          if (currentPerceivedProgress >= 89.5)
            clearInterval(perceivedProgressInterval);
        }, 200);
      }

      function updateProgressWithRealData(status) {
        if (status.progress > currentPerceivedProgress) {
          if (perceivedProgressInterval) {
            clearInterval(perceivedProgressInterval);
            perceivedProgressInterval = null;
          }
          currentPerceivedProgress = status.progress;
          const progressBar = document.getElementById("progressBar");
          const percentageText = document.getElementById("percentageText");
          if (progressBar) progressBar.style.width = `${status.progress}%`;
          if (percentageText)
            percentageText.textContent = `${Math.round(status.progress)}%`;
        }
        const progressText = document.getElementById("progressText");
        if (progressText)
          progressText.textContent = `Processed ${status.completed} / ${status.total} files.`;
      }

      async function handleDownloadComplete() {
        if (perceivedProgressInterval) clearInterval(perceivedProgressInterval);
        const progressBar = document.getElementById("progressBar");
        const percentageText = document.getElementById("percentageText");
        if (progressBar) progressBar.style.width = "100%";
        if (percentageText) percentageText.textContent = "100%";

        const progressContent = document.getElementById("progressContent");
        if (progressContent) {
          progressContent.innerHTML = "";

          const completionDiv = document.createElement("div");
          completionDiv.className = "text-center mt-4";
          completionDiv.innerHTML = `<div class="text-green-500 text-3xl mb-3">
                    <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h4 class="text-xl font-bold text-green-600">Download Complete!</h4>
                <p class="text-md text-gray-600 mt-2">Your ZIP file should be automatically downloading. Please check your browser's download list.</p>
                <button onclick="resetToInputArea()" class="mt-6 btn-primary text-white font-semibold py-3 px-6 rounded-lg transition w-full sm:w-auto">
                    Start a New Download
                </button>`;

          progressContent.appendChild(completionDiv);
        }

        await downloadBulkFile();
      }

      function handleDownloadFail() {
        const progressContent = document.getElementById("progressContent");
        if (progressContent) {
          progressContent.innerHTML = "";

          const failureDiv = document.createElement("div");
          failureDiv.className = "text-center mt-4";
          failureDiv.innerHTML = `<div class="text-red-500 text-3xl mb-3">
                      <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                  </div>
                  <h4 class="text-xl font-bold text-red-600">Download Failed</h4>
                  <p class="text-md text-gray-600 mt-2">The bulk download task could not be completed. Please check your URLs or try again later.</p>
                  <button onclick="resetToInputArea()" class="mt-6 bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg hover:bg-gray-400 transition w-full sm:w-auto">
                      Clear and Retry
                  </button>`;

          progressContent.appendChild(failureDiv);
        }
      }

      async function downloadBulkFile() {
        try {
          // Mocking API call URL for the previous version's functionality.
          const response = await fetch(
            "https://ytdlp.vistaflyer.com/api/download_zip",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ task_id: currentTaskId }),
            }
          );
          if (!response.ok)
            throw new Error(`HTTP error! Status: ${response.status}`);

          const now = new Date();
          const timestamp = `${now.getFullYear()}${String(
            now.getMonth() + 1
          ).padStart(2, "0")}${String(now.getDate()).padStart(2, "0")}_${String(
            now.getHours()
          ).padStart(2, "0")}${String(now.getMinutes()).padStart(
            2,
            "0"
          )}${String(now.getSeconds()).padStart(2, "0")}`;
          let filename = `youtube_subtitles_bulk_${timestamp}.zip`;

          const disposition = response.headers.get("content-disposition");
          if (disposition) {
            const match = disposition.match(/filename="(.+)"/);
            if (match) filename = match[1];
          }
          const blob = await response.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
          showNotification("ZIP file downloaded successfully!", "success");
        } catch (error) {
          showNotification(
            `Failed to download ZIP file: ${error.message}`,
            "error"
          );
        }
      }

      // --- UTILITIES (Notification retained) ---
      let notificationTimeout;
      function showNotification(message, type = "info") {
        clearTimeout(notificationTimeout);
        const existing = document.querySelector(".notification");
        if (existing) existing.remove();
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;

        // This style block is for the notification utility itself
        const style = document.createElement("style");
        style.textContent = `
            .notification {
                position: fixed; top: 20px; right: 20px; padding: 16px; border-radius: 8px; color: white; font-weight: 500; z-index: 1000; min-width: 320px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
                transform: translateX(calc(100% + 20px)); opacity: 0; transition: all 0.4s cubic-bezier(0.21, 1.02, 0.73, 1); display: flex; align-items: center; gap: 12px;
            }
            .notification.show { transform: translateX(0); opacity: 1; }
            .notification.success { background-color: #10b981; }
            .notification.error { background-color: #ef4444; }
            .notification.info { background-color: #3b82f6; }
        `;
        document.head.appendChild(style);

        const icons = { success: "", error: "", info: "" };
        notification.innerHTML = `<span class="font-bold text-lg">${icons[type]}</span><span>${message}</span>`;
        document.body.appendChild(notification);
        requestAnimationFrame(() => notification.classList.add("show"));
        notificationTimeout = setTimeout(() => {
          notification.classList.remove("show");
          setTimeout(() => notification.remove(), 400);
        }, 5000);
      }
    </script>
  </body>
</html>
